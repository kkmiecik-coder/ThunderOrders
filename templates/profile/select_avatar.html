{% extends "base.html" %}

{% block title %}Wybierz avatar - ThunderOrders{% endblock %}

{% block body_content %}
<div class="avatar-select-page">
    <!-- Background with K-pop gradient -->
    <div class="avatar-select-bg"></div>

    <div class="avatar-select-container">
        <!-- Header -->
        <div class="avatar-select-header">
            <img src="{{ url_for('static', filename='img/icons/logo-full.svg') }}" alt="ThunderOrders" class="logo">
            <h1>Wybierz swój avatar</h1>
            <p>Wybierz zdjęcie profilowe, które będzie Cię reprezentować w systemie</p>
        </div>

        {% if has_avatars %}
        <!-- Avatar Selection Form -->
        <form action="{{ url_for('profile.save_avatar') }}" method="POST" id="avatarForm">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <input type="hidden" name="avatar_id" id="selectedAvatarId" value="{{ current_avatar_id or '' }}">

            <!-- Series Carousels -->
            <div class="avatar-series-container">
                {% for series in series_list %}
                {% if series.avatar_count > 0 %}
                <div class="avatar-series-row">
                    <h2 class="series-title">{{ series.name }}</h2>
                    <div class="avatar-carousel">
                        <div class="avatar-carousel-track">
                            {% for avatar in series.avatars %}
                            <div class="avatar-option {% if current_avatar_id == avatar.id %}selected{% endif %}"
                                 data-avatar-id="{{ avatar.id }}"
                                 onclick="selectAvatar({{ avatar.id }}, this)">
                                <div class="avatar-image-wrapper">
                                    <img src="{{ avatar.url }}" alt="{{ series.name }}">
                                    <div class="avatar-glow"></div>
                                </div>
                                <div class="avatar-check">
                                    <svg width="24" height="24" viewBox="0 0 16 16" fill="currentColor">
                                        <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"/>
                                    </svg>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endif %}
                {% endfor %}
            </div>

            <!-- Submit Button -->
            <div class="avatar-select-actions">
                <button type="submit" class="btn btn-primary btn-lg" id="submitBtn" disabled>
                    <span class="btn-text">Zapisz avatar</span>
                    <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor" class="btn-icon">
                        <path fill-rule="evenodd" d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8z"/>
                    </svg>
                </button>
            </div>
        </form>

        {% else %}
        <!-- No avatars available -->
        <div class="no-avatars-message">
            <svg width="64" height="64" viewBox="0 0 16 16" fill="currentColor">
                <path d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/>
            </svg>
            <h2>Brak dostępnych avatarów</h2>
            <p>Administrator nie dodał jeszcze żadnych avatarów do wyboru.</p>
            {% if current_user.is_admin() %}
            <a href="{{ url_for('profile.avatars_admin') }}" class="btn btn-primary">
                Dodaj avatary
            </a>
            {% endif %}
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/profile/select_avatar.css') }}">
{% endblock %}

{% block extra_js %}
<script>
let selectedAvatarId = {{ current_avatar_id or 'null' }};

function selectAvatar(avatarId, element) {
    // Remove previous selection
    document.querySelectorAll('.avatar-option.selected').forEach(el => {
        el.classList.remove('selected');
    });

    // Add selection to clicked element
    element.classList.add('selected');

    // Update hidden input
    selectedAvatarId = avatarId;
    document.getElementById('selectedAvatarId').value = avatarId;

    // Enable submit button
    document.getElementById('submitBtn').disabled = false;
}

// Initial state - enable button if avatar already selected
if (selectedAvatarId) {
    document.getElementById('submitBtn').disabled = false;
}
</script>
{% endblock %}
