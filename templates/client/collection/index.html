{% extends "client/base_client.html" %}

{% block title %}Moja Kolekcja - ThunderOrders{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/client/collection.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/components/carousel.css') }}">
{% endblock %}

{% block content %}
<div class="collection-page client-view">
    <!-- Page Header -->
    <div class="page-header">
        <h1>Moja Kolekcja</h1>
        <div class="header-actions">
            <button class="header-action-btn action-add has-label" onclick="openAddModal()" title="Dodaj przedmiot">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                    <path d="M8 2a.5.5 0 01.5.5v5h5a.5.5 0 010 1h-5v5a.5.5 0 01-1 0v-5h-5a.5.5 0 010-1h5v-5A.5.5 0 018 2z"/>
                </svg>
                <span>Dodaj przedmiot</span>
            </button>
            <button class="header-action-btn action-public has-label" onclick="openPublicConfigModal()" title="{% if public_config %}Publiczna strona{% else %}Udostpnij kolekcj{% endif %}">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M4 12v8a2 2 0 002 2h12a2 2 0 002-2v-8"/>
                    <polyline points="16 6 12 2 8 6"/>
                    <line x1="12" y1="2" x2="12" y2="15"/>
                </svg>
                <span>{% if public_config %}Publiczna strona{% else %}Udostpnij{% endif %}</span>
            </button>
            <button class="header-action-btn action-settings" onclick="openSettingsModal()" title="Ustawienia kolekcji">
                <svg width="18" height="18" viewBox="0 0 16 16" fill="currentColor">
                    <path d="M8 4.754a3.246 3.246 0 100 6.492 3.246 3.246 0 000-6.492zM5.754 8a2.246 2.246 0 114.492 0 2.246 2.246 0 01-4.492 0z"/>
                    <path d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 01-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 01-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 01.52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 011.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 011.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 01.52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 01-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 01-1.255-.52l-.094-.319zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 002.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 001.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 00-1.115 2.693l.16.291c.415.764-.421 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 00-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 00-2.692-1.115l-.292.16c-.764.415-1.6-.421-1.184-1.185l.159-.291A1.873 1.873 0 001.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 003.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 002.692-1.115l.094-.319z"/>
                </svg>
            </button>
        </div>
    </div>

    <!-- Stats Cards -->
    <div class="collection-metrics">
        <div class="metric-card metric-card-primary" data-stat="items_count">
            <div class="metric-icon"></div>
            <div class="metric-content">
                <h3 class="metric-title">Przedmioty</h3>
                <p class="metric-value">{{ total_items }}</p>
                <p class="metric-subtitle">W kolekcji</p>
            </div>
        </div>
        {% if total_value > 0 %}
        <div class="metric-card metric-card-progress" data-stat="total_value">
            <div class="metric-icon"></div>
            <div class="metric-content">
                <h3 class="metric-title">czna warto</h3>
                <p class="metric-value">{{ "%.2f"|format(total_value) }} z</p>
                <p class="metric-subtitle">Cena rynkowa</p>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Toolbar -->
    <div class="collection-toolbar">
        <div class="toolbar-left">
            <div class="search-wrapper">
                <svg class="search-icon" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                    <path d="M11.742 10.344a6.5 6.5 0 10-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 001.415-1.414l-3.85-3.85a1.007 1.007 0 00-.115-.1zM12 6.5a5.5 5.5 0 11-11 0 5.5 5.5 0 0111 0z"/>
                </svg>
                <input type="text" class="search-input" id="collectionSearch"
                       placeholder="Szukaj w kolekcji..."
                       value="{{ search }}"
                       autocomplete="off">
                {% if search %}
                <button class="search-clear" onclick="clearSearch()" title="Wyczy">&times;</button>
                {% endif %}
            </div>
            <select class="sort-select" id="collectionSort" onchange="applySort()">
                <option value="newest" {{ 'selected' if sort == 'newest' }}>Najnowsze</option>
                <option value="oldest" {{ 'selected' if sort == 'oldest' }}>Najstarsze</option>
                <option value="name_asc" {{ 'selected' if sort == 'name_asc' }}>Nazwa A-Z</option>
                <option value="price_desc" {{ 'selected' if sort == 'price_desc' }}>Cena malejco</option>
            </select>
        </div>
        <div class="toolbar-right">
            <div class="view-toggle">
                <button class="view-btn {{ 'active' if view == 'grid' }}" onclick="setView('grid')" title="Widok siatki">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <path d="M1 2.5A1.5 1.5 0 012.5 1h3A1.5 1.5 0 017 2.5v3A1.5 1.5 0 015.5 7h-3A1.5 1.5 0 011 5.5v-3zm8 0A1.5 1.5 0 0110.5 1h3A1.5 1.5 0 0115 2.5v3A1.5 1.5 0 0113.5 7h-3A1.5 1.5 0 019 5.5v-3zm-8 8A1.5 1.5 0 012.5 9h3A1.5 1.5 0 017 10.5v3A1.5 1.5 0 015.5 15h-3A1.5 1.5 0 011 13.5v-3zm8 0A1.5 1.5 0 0110.5 9h3a1.5 1.5 0 011.5 1.5v3a1.5 1.5 0 01-1.5 1.5h-3A1.5 1.5 0 019 13.5v-3z"/>
                    </svg>
                </button>
                <button class="view-btn {{ 'active' if view == 'list' }}" onclick="setView('list')" title="Widok listy">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <path fill-rule="evenodd" d="M2.5 12a.5.5 0 01.5-.5h10a.5.5 0 010 1H3a.5.5 0 01-.5-.5zm0-4a.5.5 0 01.5-.5h10a.5.5 0 010 1H3a.5.5 0 01-.5-.5zm0-4a.5.5 0 01.5-.5h10a.5.5 0 010 1H3a.5.5 0 01-.5-.5z"/>
                    </svg>
                </button>
                <button class="view-btn {{ 'active' if view == 'carousel' }}" onclick="setView('carousel')" title="Widok karuzeli">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <path d="M1 4a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V4zm4-1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1H5zm7 0a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1h-2z"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Content -->
    {% if items %}
        <!-- Grid View -->
        <div class="collection-grid {% if view != 'grid' %}hidden{% endif %}" id="collectionGrid">
            {% for item in items %}
                {% include 'client/collection/_item_card.html' %}
            {% endfor %}
        </div>

        <!-- List View -->
        <div class="collection-list {% if view != 'list' %}hidden{% endif %}" id="collectionList">
            <div class="list-header">
                <span class="list-col col-image"></span>
                <span class="list-col col-name">Nazwa</span>
                <span class="list-col col-source">殴r贸do</span>
                <span class="list-col col-price">Cena rynkowa</span>
                <span class="list-col col-date">Data dodania</span>
                <span class="list-col col-actions">Akcje</span>
            </div>
            {% for item in items %}
                {% include 'client/collection/_item_row.html' %}
            {% endfor %}
        </div>

        <!-- Carousel View -->
        <div class="carousel-container {% if view != 'carousel' %}hidden{% endif %}" id="collectionCarousel">
            <div class="carousel-track">
                {% for item in items %}
                <div class="carousel-slide" data-item-id="{{ item.id }}" onclick="openEditModal({{ item.id }})">
                    <div class="carousel-slide-content">
                        {% if item.primary_image %}
                        <img src="{{ url_for('static', filename=item.primary_image.path_compressed) }}" alt="{{ item.name }}">
                        {% else %}
                        <img src="{{ url_for('static', filename='img/placeholders/collection-item.svg') }}" alt="{{ item.name }}" class="square">
                        {% endif %}
                        <span class="carousel-slide-name">{{ item.name }}</span>
                        {% if item.market_price %}
                        <span class="carousel-slide-price">{{ "%.2f"|format(item.market_price) }} z</span>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
            <button class="carousel-prev" id="carouselPrev" type="button">
                <svg viewBox="0 0 24 24"><polyline points="15 18 9 12 15 6"></polyline></svg>
            </button>
            <button class="carousel-next" id="carouselNext" type="button">
                <svg viewBox="0 0 24 24"><polyline points="9 6 15 12 9 18"></polyline></svg>
            </button>
        </div>

        <!-- Pagination -->
        {% if pagination.pages > 1 %}
        <div class="collection-pagination">
            <div class="pagination">
                {% if pagination.has_prev %}
                <a href="?page={{ pagination.prev_num }}&view={{ view }}&sort={{ sort }}&search={{ search }}" class="page-link">&laquo; Poprzednia</a>
                {% endif %}

                {% for page_num in pagination.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
                    {% if page_num %}
                        <a href="?page={{ page_num }}&view={{ view }}&sort={{ sort }}&search={{ search }}"
                           class="page-link {{ 'active' if page_num == pagination.page }}">{{ page_num }}</a>
                    {% else %}
                        <span class="page-ellipsis">...</span>
                    {% endif %}
                {% endfor %}

                {% if pagination.has_next %}
                <a href="?page={{ pagination.next_num }}&view={{ view }}&sort={{ sort }}&search={{ search }}" class="page-link">Nastpna &raquo;</a>
                {% endif %}
            </div>
        </div>
        {% endif %}

    {% else %}
        <!-- Empty State -->
        <div class="collection-empty">
            <div class="empty-icon">
                <img src="{{ url_for('static', filename='img/placeholders/collection-item.svg') }}" alt="Pusta kolekcja">
            </div>
            <h3 class="empty-title">
                {% if search %}
                    Brak wynik贸w dla "{{ search }}"
                {% else %}
                    Twoja kolekcja jest pusta
                {% endif %}
            </h3>
            <p class="empty-text">
                {% if search %}
                    Spr贸buj zmieni fraz wyszukiwania
                {% else %}
                    Dodaj sw贸j pierwszy przedmiot K-pop lub poczekaj na dostarczenie zam贸wienia
                {% endif %}
            </p>
            {% if not search %}
            <button class="btn btn-primary" onclick="openAddModal()">Dodaj pierwszy przedmiot</button>
            {% endif %}
        </div>
    {% endif %}
</div>

<!-- Modals -->
{% include 'client/collection/_add_modal.html' %}
{% include 'client/collection/_edit_modal.html' %}
{% include 'client/collection/_delete_confirm.html' %}
{% include 'client/collection/_public_config_modal.html' %}
{% include 'client/collection/_settings_modal.html' %}
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/pages/client/collection.js') }}"></script>
{% endblock %}
