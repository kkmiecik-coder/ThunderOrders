{% extends "base.html" %}

{% block html_class %}auth-html{% endblock %}
{% block body_class %}auth-page-body{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/auth/auth-unified.css') }}">
{% endblock %}

{% block title %}
{% if mode == 'register' %}Rejestracja{% elif mode == 'forgot' %}Resetowanie hasla{% elif mode == 'reset' %}Nowe haslo{% elif mode == 'verify' %}Weryfikacja{% elif mode == 'success' %}Sukces{% else %}Konto{% endif %} - ThunderOrders
{% endblock %}

{% block body_content %}
<div class="auth-page">
    <!-- Glass Container -->
    <div class="auth-container {% if mode == 'success' %}success-mode{% endif %}">
        <!-- Logo -->
        <div class="auth-logo">
            <a href="{{ url_for('auth.login') }}">
                <img src="{{ url_for('static', filename='img/icons/logo-full.svg') }}" alt="ThunderOrders">
            </a>
        </div>


        <!-- Step container -->
        <div class="auth-steps-container">
            <!-- ==================== REGISTER STEP ==================== -->
            {% if mode == 'register' %}
            <div class="auth-step active" data-step="register">
                <div class="auth-header">
                    <h1 class="auth-title">Utw칩rz konto</h1>
                    <p class="auth-subtitle">Do켹캔cz do ThunderOrders ju콮 dzi콑</p>
                </div>

                <form method="POST" action="{{ url_for('auth.register') }}" class="auth-form" id="register-form">
                    {{ form.hidden_tag() }}

                    <!-- First Name & Last Name - Grid -->
                    <div class="auth-name-grid">
                        <div class="auth-input-group">
                            <div class="input-wrapper">
                                {{ form.first_name(class="auth-input", placeholder=" ", autofocus=true, id="first_name") }}
                                <label for="first_name" class="auth-input-label">Imi캧 *</label>
                                <div class="input-glow"></div>
                            </div>
                            {% if form.first_name.errors %}
                            <div class="form-error">{{ form.first_name.errors[0] }}</div>
                            {% endif %}
                        </div>

                        <div class="auth-input-group">
                            <div class="input-wrapper">
                                {{ form.last_name(class="auth-input", placeholder=" ", id="last_name") }}
                                <label for="last_name" class="auth-input-label">Nazwisko *</label>
                                <div class="input-glow"></div>
                            </div>
                            {% if form.last_name.errors %}
                            <div class="form-error">{{ form.last_name.errors[0] }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Email Input -->
                    <div class="auth-input-group">
                        <div class="input-wrapper">
                            {{ form.email(class="auth-input", placeholder=" ", id="email") }}
                            <label for="email" class="auth-input-label">E-mail *</label>
                            <div class="input-glow"></div>
                        </div>
                        {% if form.email.errors %}
                        <div class="form-error">{{ form.email.errors[0] }}</div>
                        {% endif %}
                    </div>

                    <!-- Phone Input with Country Prefix -->
                    <div class="auth-input-group">
                        <div class="phone-input-container">
                            <!-- Country Prefix Selector -->
                            <div class="phone-prefix-selector" id="phone-prefix-selector">
                                <button type="button" class="phone-prefix-btn" id="phone-prefix-btn">
                                    <span class="prefix-flag" id="selected-flag">游왫릖</span>
                                    <span class="prefix-code" id="selected-prefix">+48</span>
                                    <svg class="prefix-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="6 9 12 15 18 9"></polyline>
                                    </svg>
                                </button>
                                <!-- Hidden input for form submission -->
                                {{ form.phone_prefix(id="phone_prefix", value="+48") }}

                                <!-- Dropdown -->
                                <div class="phone-prefix-dropdown" id="phone-prefix-dropdown">
                                    <div class="prefix-option" data-prefix="+48" data-flag="游왫릖" data-country="Polska" data-length="9">
                                        <span class="prefix-flag">游왫릖</span>
                                        <span class="prefix-country">Polska</span>
                                        <span class="prefix-code">(+48)</span>
                                    </div>
                                    <div class="prefix-option" data-prefix="+49" data-flag="游뾇릖" data-country="Niemcy" data-length="10,11">
                                        <span class="prefix-flag">游뾇릖</span>
                                        <span class="prefix-country">Niemcy</span>
                                        <span class="prefix-code">(+49)</span>
                                    </div>
                                    <div class="prefix-option" data-prefix="+44" data-flag="游섫릖" data-country="Wielka Brytania" data-length="10">
                                        <span class="prefix-flag">游섫릖</span>
                                        <span class="prefix-country">Wielka Brytania</span>
                                        <span class="prefix-code">(+44)</span>
                                    </div>
                                    <div class="prefix-option" data-prefix="+33" data-flag="游游" data-country="Francja" data-length="9">
                                        <span class="prefix-flag">游游</span>
                                        <span class="prefix-country">Francja</span>
                                        <span class="prefix-code">(+33)</span>
                                    </div>
                                    <div class="prefix-option" data-prefix="+420" data-flag="游뻟릖" data-country="Czechy" data-length="9">
                                        <span class="prefix-flag">游뻟릖</span>
                                        <span class="prefix-country">Czechy</span>
                                        <span class="prefix-code">(+420)</span>
                                    </div>
                                    <div class="prefix-option" data-prefix="+421" data-flag="游젏릖" data-country="S켹owacja" data-length="9">
                                        <span class="prefix-flag">游젏릖</span>
                                        <span class="prefix-country">S켹owacja</span>
                                        <span class="prefix-code">(+421)</span>
                                    </div>
                                    <div class="prefix-option" data-prefix="+380" data-flag="游쥟릖" data-country="Ukraina" data-length="9">
                                        <span class="prefix-flag">游쥟릖</span>
                                        <span class="prefix-country">Ukraina</span>
                                        <span class="prefix-code">(+380)</span>
                                    </div>
                                    <div class="prefix-option" data-prefix="+43" data-flag="游뷣릖" data-country="Austria" data-length="10,11">
                                        <span class="prefix-flag">游뷣릖</span>
                                        <span class="prefix-country">Austria</span>
                                        <span class="prefix-code">(+43)</span>
                                    </div>
                                    <div class="prefix-option" data-prefix="+31" data-flag="游游" data-country="Holandia" data-length="9">
                                        <span class="prefix-flag">游游</span>
                                        <span class="prefix-country">Holandia</span>
                                        <span class="prefix-code">(+31)</span>
                                    </div>
                                    <div class="prefix-option" data-prefix="+32" data-flag="游游" data-country="Belgia" data-length="9">
                                        <span class="prefix-flag">游游</span>
                                        <span class="prefix-country">Belgia</span>
                                        <span class="prefix-code">(+32)</span>
                                    </div>
                                    <div class="prefix-option" data-prefix="+39" data-flag="游쉻릖" data-country="W켹ochy" data-length="9,10">
                                        <span class="prefix-flag">游쉻릖</span>
                                        <span class="prefix-country">W켹ochy</span>
                                        <span class="prefix-code">(+39)</span>
                                    </div>
                                    <div class="prefix-option" data-prefix="+34" data-flag="游쀯릖" data-country="Hiszpania" data-length="9">
                                        <span class="prefix-flag">游쀯릖</span>
                                        <span class="prefix-country">Hiszpania</span>
                                        <span class="prefix-code">(+34)</span>
                                    </div>
                                    <div class="prefix-option" data-prefix="+1" data-flag="游쥟릖" data-country="USA" data-length="10">
                                        <span class="prefix-flag">游쥟릖</span>
                                        <span class="prefix-country">USA</span>
                                        <span class="prefix-code">(+1)</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Phone Number Input -->
                            <div class="phone-number-wrapper">
                                {{ form.phone_number(class="auth-input phone-number-input", placeholder=" ", id="phone_number", inputmode="tel") }}
                                <label for="phone_number" class="auth-input-label phone-label">Numer telefonu *</label>
                                <div class="input-glow"></div>
                            </div>
                        </div>
                        {% if form.phone_prefix.errors %}
                        <div class="form-error">{{ form.phone_prefix.errors[0] }}</div>
                        {% endif %}
                        {% if form.phone_number.errors %}
                        <div class="form-error">{{ form.phone_number.errors[0] }}</div>
                        {% endif %}
                    </div>

                    <!-- Password Input with Toggle -->
                    <div class="auth-input-group">
                        <div class="input-wrapper">
                            {{ form.password(class="auth-input", placeholder=" ", id="password-input") }}
                            <label for="password-input" class="auth-input-label">Has켹o *</label>
                            <button type="button" class="password-toggle-btn" tabindex="-1" aria-label="Poka콮 has켹o">
                                <svg class="eye-open" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                    <circle cx="12" cy="12" r="3"></circle>
                                </svg>
                                <svg class="eye-closed" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:none">
                                    <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                                    <line x1="1" y1="1" x2="23" y2="23"></line>
                                </svg>
                            </button>
                            <div class="input-glow"></div>
                        </div>
                        {% if form.password.errors %}
                        <div class="form-error">{{ form.password.errors[0] }}</div>
                        {% endif %}
                    </div>

                    <!-- Password Requirements -->
                    <div class="password-requirements" id="password-requirements">
                        <div class="req-item" id="req-length" data-valid="false">
                            <span class="req-icon"></span>
                            <span>Min. 8 znak칩w</span>
                        </div>
                        <div class="req-item" id="req-uppercase" data-valid="false">
                            <span class="req-icon"></span>
                            <span>Wielka litera</span>
                        </div>
                        <div class="req-item" id="req-lowercase" data-valid="false">
                            <span class="req-icon"></span>
                            <span>Ma켹a litera</span>
                        </div>
                        <div class="req-item" id="req-number" data-valid="false">
                            <span class="req-icon"></span>
                            <span>Cyfra</span>
                        </div>
                    </div>

                    <!-- Password Confirm Input with Toggle -->
                    <div class="auth-input-group">
                        <div class="input-wrapper">
                            {{ form.password_confirm(class="auth-input", placeholder=" ", id="password-confirm-input") }}
                            <label for="password-confirm-input" class="auth-input-label">Potwierd콬 has켹o *</label>
                            <button type="button" class="password-toggle-btn" tabindex="-1" aria-label="Poka콮 has켹o">
                                <svg class="eye-open" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                    <circle cx="12" cy="12" r="3"></circle>
                                </svg>
                                <svg class="eye-closed" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:none">
                                    <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                                    <line x1="1" y1="1" x2="23" y2="23"></line>
                                </svg>
                            </button>
                            <div class="input-glow"></div>
                        </div>
                        {% if form.password_confirm.errors %}
                        <div class="form-error">{{ form.password_confirm.errors[0] }}</div>
                        {% endif %}
                    </div>

                    <!-- Analytics Consent Checkbox (RODO) -->
                    <div class="auth-input-group">
                        <label class="checkbox-label">
                            <input type="checkbox" name="analytics_consent" id="analytics_consent" class="analytics-checkbox">
                            <span class="checkbox-text">
                                Zgadzam si캧 na pliki cookie analityczne (Google Analytics)
                                <a href="{{ url_for('privacy_policy') }}" target="_blank" class="privacy-link">Polityka prywatno콑ci</a>
                            </span>
                        </label>
                    </div>

                    <!-- Required Fields Note -->
                    <div class="required-fields-note">
                        <span class="required-asterisk">*</span> Pole wymagane
                    </div>

                    <!-- Submit Button -->
                    <button type="submit" class="auth-submit">
                        <span class="btn-text">Zarejestruj si캧</span>
                        <span class="btn-loader"></span>
                        <div class="btn-shine"></div>
                    </button>
                </form>

                <!-- Login Link -->
                <div class="auth-footer">
                    <p>Masz ju콮 konto?</p>
                    <a href="{{ url_for('auth.login') }}" class="auth-link">
                        <span>Zaloguj si캧</span>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                            <polyline points="12 5 19 12 12 19"></polyline>
                        </svg>
                    </a>
                </div>
            </div>
            {% endif %}

            <!-- ==================== VERIFY CODE STEP ==================== -->
            {% if mode == 'verify' %}
            <div class="auth-step active" data-step="verify">
                <div class="auth-header">
                    <h1 class="auth-title">Weryfikacja email</h1>
                    <p class="auth-subtitle">
                        Wys켹ali콑my 6-cyfrowy kod na adres:<br>
                        <strong class="highlight-email">{{ user_email }}</strong>
                    </p>
                </div>

                <form method="POST" action="{{ url_for('auth.verify_email_code', token=token) }}" class="auth-form" id="verification-form">
                    {{ form.hidden_tag() }}

                    <!-- 6-digit Code Inputs -->
                    <div class="code-inputs-container">
                        <div class="code-inputs">
                            {{ form.digit1(class="code-input", id="digit1", inputmode="numeric", pattern="[0-9]*", maxlength="1", autocomplete="one-time-code") }}
                            {{ form.digit2(class="code-input", id="digit2", inputmode="numeric", pattern="[0-9]*", maxlength="1") }}
                            {{ form.digit3(class="code-input", id="digit3", inputmode="numeric", pattern="[0-9]*", maxlength="1") }}
                            {{ form.digit4(class="code-input", id="digit4", inputmode="numeric", pattern="[0-9]*", maxlength="1") }}
                            {{ form.digit5(class="code-input", id="digit5", inputmode="numeric", pattern="[0-9]*", maxlength="1") }}
                            {{ form.digit6(class="code-input", id="digit6", inputmode="numeric", pattern="[0-9]*", maxlength="1") }}
                        </div>
                        <div class="code-error" style="display: none;"></div>
                    </div>

                    <!-- Submit Button -->
                    <button type="submit" class="auth-submit" id="verify-btn">
                        <span class="btn-text">Weryfikuj</span>
                        <span class="btn-loader"></span>
                        <div class="btn-shine"></div>
                    </button>

                    <!-- Resend Code -->
                    <div class="resend-container">
                        <p class="resend-text" id="resend-text">
                            {% if can_resend %}
                            Nie otrzyma켹e콑 kodu?
                            {% else %}
                            Wy콑lij kod ponownie za <span id="countdown" class="countdown">{{ seconds_remaining }}</span>s
                            {% endif %}
                        </p>
                        <button type="button"
                                class="resend-btn {% if not can_resend %}disabled{% endif %}"
                                id="resend-btn"
                                data-token="{{ token }}"
                                {% if not can_resend %}disabled{% endif %}>
                            Wy콑lij ponownie
                        </button>
                    </div>
                </form>

                <!-- Back to Login -->
                <div class="auth-footer">
                    <a href="{{ url_for('auth.login') }}" class="auth-link back-link">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="19" y1="12" x2="5" y2="12"></line>
                            <polyline points="12 19 5 12 12 5"></polyline>
                        </svg>
                        <span>Powr칩t do logowania</span>
                    </a>
                </div>
            </div>
            {% endif %}

            <!-- ==================== FORGOT PASSWORD STEP ==================== -->
            {% if mode == 'forgot' %}
            <div class="auth-step active" data-step="forgot">
                <div class="auth-header">
                    <h1 class="auth-title">Zresetuj has켹o</h1>
                    <p class="auth-subtitle">Podaj sw칩j email, a wy콑lemy Ci link do resetowania has켹a.</p>
                </div>

                <form method="POST" action="{{ url_for('auth.forgot_password') }}" class="auth-form" id="forgot-form">
                    {{ form.hidden_tag() }}

                    <!-- Email Input -->
                    <div class="auth-input-group">
                        <div class="input-wrapper">
                            {{ form.email(class="auth-input", placeholder=" ", autofocus=true, id="email") }}
                            <label for="email" class="auth-input-label">E-mail</label>
                            <div class="input-glow"></div>
                        </div>
                        {% if form.email.errors %}
                        <div class="form-error">{{ form.email.errors[0] }}</div>
                        {% endif %}
                    </div>

                    <!-- Submit Button -->
                    <button type="submit" class="auth-submit">
                        <span class="btn-text">Wy콑lij link</span>
                        <span class="btn-loader"></span>
                        <div class="btn-shine"></div>
                    </button>
                </form>

                <!-- Back to Login -->
                <div class="auth-footer">
                    <a href="{{ url_for('auth.login') }}" class="auth-link back-link">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="19" y1="12" x2="5" y2="12"></line>
                            <polyline points="12 19 5 12 12 5"></polyline>
                        </svg>
                        <span>Powr칩t do logowania</span>
                    </a>
                </div>
            </div>
            {% endif %}

            <!-- ==================== FORGOT PASSWORD CONFIRMATION ==================== -->
            {% if mode == 'forgot_sent' %}
            <div class="auth-step active" data-step="forgot-sent">
                <div class="auth-header">
                    <div class="success-icon-container">
                        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M22 2L11 13"></path>
                            <path d="M22 2L15 22L11 13L2 9L22 2Z"></path>
                        </svg>
                    </div>
                    <h1 class="auth-title">Sprawd콬 skrzynk캧</h1>
                    <p class="auth-subtitle">Wys켹ali콑my link do resetowania has켹a na podany adres email.</p>
                </div>

                <div class="info-box">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="16" x2="12" y2="12"></line>
                        <line x1="12" y1="8" x2="12.01" y2="8"></line>
                    </svg>
                    <div>
                        <strong>Nie otrzyma켹e콑 emaila?</strong><br>
                        Sprawd콬 folder spam lub <a href="{{ url_for('auth.forgot_password') }}">wy콑lij ponownie</a>
                    </div>
                </div>

                <a href="{{ url_for('auth.login') }}" class="auth-submit">
                    <span class="btn-text">Wr칩캖 do logowania</span>
                    <div class="btn-shine"></div>
                </a>
            </div>
            {% endif %}

            <!-- ==================== RESET PASSWORD STEP ==================== -->
            {% if mode == 'reset' %}
            <div class="auth-step active" data-step="reset">
                <div class="auth-header">
                    <h1 class="auth-title">Ustaw nowe has켹o</h1>
                    <p class="auth-subtitle">Wprowad콬 nowe has켹o do swojego konta.</p>
                </div>

                <form method="POST" action="{{ url_for('auth.reset_password', token=token) }}" class="auth-form" id="reset-form">
                    {{ form.hidden_tag() }}

                    <!-- Password Input -->
                    <div class="auth-input-group">
                        <div class="input-wrapper">
                            {{ form.password(class="auth-input", placeholder=" ", id="password-input", autofocus=true) }}
                            <label for="password-input" class="auth-input-label">Nowe has켹o</label>
                            <button type="button" class="password-toggle-btn" tabindex="-1" aria-label="Poka콮 has켹o">
                                <svg class="eye-open" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                    <circle cx="12" cy="12" r="3"></circle>
                                </svg>
                                <svg class="eye-closed" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:none">
                                    <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                                    <line x1="1" y1="1" x2="23" y2="23"></line>
                                </svg>
                            </button>
                            <div class="input-glow"></div>
                        </div>
                        {% if form.password.errors %}
                        <div class="form-error">{{ form.password.errors[0] }}</div>
                        {% endif %}
                    </div>

                    <!-- Password Requirements -->
                    <div class="password-requirements" id="password-requirements">
                        <div class="req-item" id="req-length" data-valid="false">
                            <span class="req-icon"></span>
                            <span>Min. 8 znak칩w</span>
                        </div>
                        <div class="req-item" id="req-uppercase" data-valid="false">
                            <span class="req-icon"></span>
                            <span>Wielka litera</span>
                        </div>
                        <div class="req-item" id="req-lowercase" data-valid="false">
                            <span class="req-icon"></span>
                            <span>Ma켹a litera</span>
                        </div>
                        <div class="req-item" id="req-number" data-valid="false">
                            <span class="req-icon"></span>
                            <span>Cyfra</span>
                        </div>
                    </div>

                    <!-- Password Confirm Input -->
                    <div class="auth-input-group">
                        <div class="input-wrapper">
                            {{ form.password_confirm(class="auth-input", placeholder=" ", id="password-confirm-input") }}
                            <label for="password-confirm-input" class="auth-input-label">Potwierd콬 nowe has켹o</label>
                            <button type="button" class="password-toggle-btn" tabindex="-1" aria-label="Poka콮 has켹o">
                                <svg class="eye-open" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                    <circle cx="12" cy="12" r="3"></circle>
                                </svg>
                                <svg class="eye-closed" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:none">
                                    <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                                    <line x1="1" y1="1" x2="23" y2="23"></line>
                                </svg>
                            </button>
                            <div class="input-glow"></div>
                        </div>
                        {% if form.password_confirm.errors %}
                        <div class="form-error">{{ form.password_confirm.errors[0] }}</div>
                        {% endif %}
                    </div>

                    <!-- Submit Button -->
                    <button type="submit" class="auth-submit">
                        <span class="btn-text">Zmie켻 has켹o</span>
                        <span class="btn-loader"></span>
                        <div class="btn-shine"></div>
                    </button>
                </form>

                <!-- Back to Login -->
                <div class="auth-footer">
                    <a href="{{ url_for('auth.login') }}" class="auth-link back-link">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="19" y1="12" x2="5" y2="12"></line>
                            <polyline points="12 19 5 12 12 5"></polyline>
                        </svg>
                        <span>Powr칩t do logowania</span>
                    </a>
                </div>
            </div>
            {% endif %}

            <!-- ==================== VERIFICATION SUCCESS ==================== -->
            {% if mode == 'success' %}
            <div class="auth-step active success-step" data-step="success">
                <div class="auth-header">
                    <div class="success-animation">
                        <svg class="checkmark" width="80" height="80" viewBox="0 0 52 52">
                            <circle class="checkmark-circle" cx="26" cy="26" r="25" fill="none"/>
                            <path class="checkmark-check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
                        </svg>
                    </div>
                    <h1 class="auth-title success-title">{{ success_title|default('Konto aktywowane!') }}</h1>
                    <p class="auth-subtitle">{{ success_message|default('Tw칩j adres email zosta켹 pomy콑lnie zweryfikowany. Mo콮esz teraz zalogowa캖 si캧 na swoje konto.') }}</p>
                </div>

                <a href="{{ url_for('auth.login') }}" class="auth-submit success-btn">
                    <span class="btn-text">Przejd콬 do logowania</span>
                    <div class="btn-shine"></div>
                </a>
            </div>
            {% endif %}

        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/pages/auth/auth-unified.js') }}"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Floating label handling
    document.querySelectorAll('.auth-input').forEach(input => {
        if (input.value) {
            input.classList.add('has-value');
        }

        input.addEventListener('input', function() {
            this.classList.toggle('has-value', this.value.length > 0);
        });
    });

    // Form loading state
    document.querySelectorAll('.auth-form').forEach(form => {
        form.addEventListener('submit', function() {
            const btn = this.querySelector('.auth-submit');
            if (btn) {
                btn.classList.add('loading');
            }
        });
    });

    // Password toggles
    document.querySelectorAll('.password-toggle-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const wrapper = this.closest('.input-wrapper');
            const input = wrapper.querySelector('input');
            const eyeOpen = this.querySelector('.eye-open');
            const eyeClosed = this.querySelector('.eye-closed');

            if (input.type === 'password') {
                input.type = 'text';
                eyeOpen.style.display = 'none';
                eyeClosed.style.display = 'block';
                this.classList.add('active');
            } else {
                input.type = 'password';
                eyeOpen.style.display = 'block';
                eyeClosed.style.display = 'none';
                this.classList.remove('active');
            }
        });
    });
});
</script>
{% if mode == 'verify' and not can_resend %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        if (typeof initCountdown === 'function') {
            initCountdown({{ seconds_remaining }});
        }
    });
</script>
{% endif %}
{% endblock %}
