<!-- Cookie Consent Banner (RODO-compliant) -->
<div id="cookieBanner" class="cookie-banner" style="display: none;">
    <div class="cookie-banner-content">
        <div class="cookie-banner-text">
            <h3>ğŸª Ta strona uÅ¼ywa plikÃ³w cookie</h3>
            <p>
                UÅ¼ywamy Google Analytics w celu poprawy jakoÅ›ci usÅ‚ug i analizy ruchu na stronie.
                Dane sÄ… anonimizowane i nie identyfikujÄ… CiÄ™ osobiÅ›cie.
                <a href="{{ url_for('privacy_policy') }}" target="_blank">Polityka prywatnoÅ›ci</a>
            </p>
        </div>
        <div class="cookie-banner-actions">
            <button id="cookieAccept" class="btn btn-primary">AkceptujÄ™</button>
            <button id="cookieReject" class="btn btn-secondary">OdrzuÄ‡</button>
        </div>
    </div>
</div>

<script>
    // PokaÅ¼ banner jeÅ›li potrzeba
    if (window.showCookieBanner) {
        document.getElementById('cookieBanner').style.display = 'block';
    }

    // Akceptuj
    document.getElementById('cookieAccept')?.addEventListener('click', function() {
        {% if current_user.is_authenticated %}
            // Zapisz zgodÄ™ w bazie
            fetch('/api/analytics-consent', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': document.querySelector('meta[name="csrf-token"]').content
                },
                body: JSON.stringify({ consent: true })
            }).then(() => {
                if (typeof loadGoogleAnalytics === 'function') {
                    loadGoogleAnalytics();
                }
                document.getElementById('cookieBanner').style.display = 'none';
            });
        {% else %}
            // GoÅ›Ä‡ â†’ localStorage
            localStorage.setItem('analytics_consent', 'accepted');
            if (typeof loadGoogleAnalytics === 'function') {
                loadGoogleAnalytics();
            }
            document.getElementById('cookieBanner').style.display = 'none';
        {% endif %}
    });

    // OdrzuÄ‡
    document.getElementById('cookieReject')?.addEventListener('click', function() {
        {% if current_user.is_authenticated %}
            fetch('/api/analytics-consent', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': document.querySelector('meta[name="csrf-token"]').content
                },
                body: JSON.stringify({ consent: false })
            }).then(() => {
                document.getElementById('cookieBanner').style.display = 'none';
            });
        {% else %}
            localStorage.setItem('analytics_consent', 'rejected');
            document.getElementById('cookieBanner').style.display = 'none';
        {% endif %}
    });
</script>
