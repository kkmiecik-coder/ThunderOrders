<!-- Topbar -->
<header class="topbar">
    <!-- Left: Sidebar Toggle -->
    <div class="topbar-left">
        <button class="topbar-btn topbar-sidebar-toggle" id="sidebarToggle" aria-label="Toggle sidebar">
            <img src="{{ url_for('static', filename='img/icons/chevron-left.svg') }}" alt="Toggle">
        </button>
    </div>

    <!-- Center: Search -->
    <div class="topbar-center">
        <!-- Search Dropdown (shown when active) -->
        <div class="global-search-wrapper" id="globalSearchWrapper">
            <div class="global-search-input-wrapper">
                <img src="{{ url_for('static', filename='img/icons/search.svg') }}" alt="Search" class="global-search-icon">
                <input type="text" id="globalSearchInput" class="global-search-input"
                       placeholder="Szukaj..."
                       autocomplete="off" spellcheck="false">
                <kbd class="global-search-kbd">ESC</kbd>
            </div>
            <div class="global-search-dropdown" id="globalSearchDropdown"></div>
        </div>
        <!-- Search Button (hidden when dropdown active) -->
        <button class="topbar-search-btn" id="globalSearchBtn">
            <img src="{{ url_for('static', filename='img/icons/search.svg') }}" alt="Search">
            <span class="topbar-search-text">Szukaj...</span>
            <kbd class="topbar-search-kbd">⌘K</kbd>
        </button>
    </div>

    <!-- Right: Actions -->
    <div class="topbar-right">
        <!-- Facebook Group -->
        <a href="https://www.facebook.com/groups/2598228800416411" target="_blank" rel="noopener noreferrer" class="topbar-fb-btn" aria-label="Grupa Facebook">
            <img src="{{ url_for('static', filename='img/icons/logo-icon.svg') }}" alt="ThunderOrders" class="topbar-fb-icon">
            <span class="topbar-fb-text">Grupa FB</span>
        </a>

        <!-- User Dropdown -->
        <div class="topbar-user-dropdown">
            <button class="topbar-user-btn" id="userDropdownBtn" aria-label="User menu">
                <div class="topbar-user-avatar {% if current_user.has_avatar %}has-avatar{% endif %}">
                    {% if current_user.has_avatar %}
                    <img src="{{ current_user.avatar_url }}" alt="{{ current_user.first_name }}">
                    {% else %}
                    <img src="{{ url_for('static', filename='img/icons/user.svg') }}" alt="{{ current_user.first_name }}">
                    {% endif %}
                </div>
                <div class="topbar-user-info">
                    <span class="topbar-user-name">{{ current_user.first_name }} {{ current_user.last_name }}</span>
                    <span class="topbar-user-role">{{ current_user.role|capitalize }}</span>
                </div>
            </button>

            <!-- Dropdown Menu -->
            <div class="topbar-dropdown-menu" id="userDropdownMenu">
                <a href="{{ url_for('profile.index') }}" class="topbar-dropdown-item">
                    <img src="{{ url_for('static', filename='img/icons/user.svg') }}" alt="Profile">
                    <span>Mój Profil</span>
                </a>
                <div class="topbar-dropdown-divider"></div>
                <button class="topbar-dropdown-item topbar-dropdown-theme" id="darkModeToggle" aria-label="Toggle dark mode">
                    <img src="{{ url_for('static', filename='img/icons/sun.svg') }}" alt="Light mode" class="icon-light">
                    <img src="{{ url_for('static', filename='img/icons/moon.svg') }}" alt="Dark mode" class="icon-dark">
                    <span class="topbar-dropdown-theme-text">
                        <span class="text-light">Tryb ciemny</span>
                        <span class="text-dark">Tryb jasny</span>
                    </span>
                </button>
                {% if current_user.role in ['admin', 'mod'] %}
                <a href="{{ url_for('switch_view') }}" class="topbar-dropdown-item topbar-dropdown-switch">
                    <img src="{{ url_for('static', filename='img/icons/switch-view.svg') }}" alt="Switch view">
                    {% if request.path.startswith('/client') %}
                    <span>Widok admina</span>
                    {% else %}
                    <span>Widok klienta</span>
                    {% endif %}
                </a>
                <div class="topbar-dropdown-divider"></div>
                {% endif %}
                <a href="{{ url_for('auth.logout') }}" class="topbar-dropdown-item topbar-dropdown-item-danger">
                    <img src="{{ url_for('static', filename='img/icons/logout.svg') }}" alt="Logout">
                    <span>Wyloguj</span>
                </a>
            </div>
        </div>
    </div>
</header>

<!-- Mobile Navbar -->
<header class="mobile-navbar">
    <button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Toggle menu">
        <img src="{{ url_for('static', filename='img/icons/menu.svg') }}" alt="Menu">
    </button>

    <div class="mobile-logo">
        <img src="{{ url_for('static', filename='img/icons/logo-icon.svg') }}" alt="ThunderOrders">
    </div>

    <button class="mobile-search-btn" id="mobileSearchBtn" aria-label="Search">
        <img src="{{ url_for('static', filename='img/icons/search.svg') }}" alt="Search">
    </button>
</header>

<!-- Global Search Backdrop (desktop) -->
<div class="global-search-backdrop" id="globalSearchBackdrop"></div>

<!-- Global Search Mobile Overlay -->
<div class="global-search-mobile-overlay" id="globalSearchMobileOverlay">
    <div class="global-search-mobile-header">
        <button class="global-search-mobile-back" id="globalSearchMobileBack" aria-label="Zamknij wyszukiwanie">
            <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M10 3L5 8l5 5"/>
            </svg>
        </button>
        <input type="text" id="globalSearchMobileInput" class="global-search-mobile-input"
               placeholder="Szukaj..." autocomplete="off" spellcheck="false">
    </div>
    <div class="global-search-mobile-results" id="globalSearchMobileResults"></div>
</div>

<!-- Mobile Menu Overlay -->
<div class="mobile-menu-overlay" id="mobileMenuOverlay">
    <div class="mobile-menu-content">
        <div class="mobile-menu-header">
            <img src="{{ url_for('static', filename='img/icons/logo-full.svg') }}" alt="ThunderOrders">
            <button class="mobile-menu-close" id="mobileMenuClose">×</button>
        </div>

        <nav class="mobile-menu-nav">
            <!-- Content będzie kopiowany z sidebara przez JS -->
        </nav>

        <div class="mobile-menu-footer">
            <a href="{{ url_for('profile.index') }}" class="mobile-menu-user">
                <div class="mobile-menu-user-avatar {% if current_user.has_avatar %}has-avatar{% endif %}">
                    {% if current_user.has_avatar %}
                    <img src="{{ current_user.avatar_url }}" alt="{{ current_user.first_name }}">
                    {% else %}
                    <img src="{{ url_for('static', filename='img/icons/user.svg') }}" alt="{{ current_user.first_name }}">
                    {% endif %}
                </div>
                <div class="mobile-menu-user-info">
                    <span class="mobile-menu-user-name">{{ current_user.first_name }} {{ current_user.last_name }}</span>
                    <span class="mobile-menu-user-role">{{ current_user.role|capitalize }}</span>
                </div>
                <svg class="mobile-menu-user-arrow" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                    <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/>
                </svg>
            </a>

            <!-- Dark Mode Toggle -->
            <button class="mobile-menu-theme-toggle" id="mobileDarkModeToggle" aria-label="Toggle dark mode">
                <img src="{{ url_for('static', filename='img/icons/sun.svg') }}" alt="Light mode" class="icon-light">
                <img src="{{ url_for('static', filename='img/icons/moon.svg') }}" alt="Dark mode" class="icon-dark">
                <span class="mobile-theme-text">
                    <span class="text-light">Tryb jasny</span>
                    <span class="text-dark">Tryb ciemny</span>
                </span>
            </button>

            <a href="https://www.facebook.com/groups/2598228800416411" target="_blank" rel="noopener noreferrer" class="mobile-menu-fb-btn">
                <img src="{{ url_for('static', filename='img/icons/logo-icon.svg') }}" alt="ThunderOrders" class="mobile-menu-fb-icon">
                <span>Grupa Facebook</span>
            </a>

            {% if current_user.role in ['admin', 'mod'] %}
            <a href="{{ url_for('switch_view') }}" class="mobile-menu-switch-view">
                <img src="{{ url_for('static', filename='img/icons/switch-view.svg') }}" alt="Switch view">
                {% if request.path.startswith('/client') %}
                <span>Widok admina</span>
                {% else %}
                <span>Widok klienta</span>
                {% endif %}
            </a>
            {% endif %}

            <a href="{{ url_for('auth.logout') }}" class="mobile-menu-logout">
                <img src="{{ url_for('static', filename='img/icons/logout.svg') }}" alt="Logout">
                <span>Wyloguj</span>
            </a>
        </div>
    </div>
</div>
