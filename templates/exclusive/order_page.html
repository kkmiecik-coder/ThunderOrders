{% extends "exclusive/base_exclusive.html" %}

{% block title %}{{ page.name }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/exclusive/order-page.css') }}">
{% endblock %}

{% block body_content %}
<div class="exclusive-order-page">
    <!-- Sticky Reservation Header -->
    <div id="reservationHeader" class="reservation-header hidden">
        <div class="reservation-content">
            <!-- Lewa strona - ikona + "Rezerwacja aktywna" -->
            <div class="reservation-left">
                <div class="reservation-icon">
                    <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor">
                        <path d="M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71V3.5z"/>
                        <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0z"/>
                    </svg>
                </div>
                <span class="reservation-label">Rezerwacja aktywna</span>
            </div>
            <!-- ≈örodek - "Wygasa za" + du≈ºy timer -->
            <div class="reservation-center">
                <span class="reservation-sublabel">Wygasa za</span>
                <span class="reservation-timer" id="reservationTimer">Sprawdzam...</span>
            </div>
            <!-- Prawa strona - przycisk przed≈Çu≈ºenia -->
            <div class="reservation-right">
                <button id="extendBtn" class="btn-extend" onclick="extendReservation()">
                    Przed≈Çu≈º +2 min
                </button>
            </div>
        </div>
    </div>

    <!-- Animated Background -->
    <div class="order-animated-bg">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
        <div class="orb orb-3"></div>
        <div class="orb orb-4"></div>
    </div>

    {% if preview_mode %}
    <!-- Preview Mode Banner -->
    <div class="preview-mode-banner">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
            <path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8zM1.173 8a13.133 13.133 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.133 13.133 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5c-2.12 0-3.879-1.168-5.168-2.457A13.134 13.134 0 0 1 1.172 8z"/>
            <path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5zM4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0z"/>
        </svg>
        <span>Tryb podglƒÖdu - Status strony: <strong>{{ page.status|upper }}</strong></span>
        <a href="{{ url_for('admin.exclusive_edit', page_id=page.id) }}" class="preview-back-link">Wr√≥ƒá do edycji</a>
    </div>
    {% endif %}

    <!-- Header -->
    <header class="page-header">
        <div class="header-content">
            <!-- Logo na samej g√≥rze -->
            <div class="header-logo">
                <img src="{{ url_for('static', filename='img/icons/logo-full.svg') }}" alt="ThunderOrders" class="logo-image">
            </div>

            <!-- Lewa kolumna: Tytu≈Ç i Opis -->
            <div class="header-main">
                <div class="header-left">
                    <h1>{{ page.name }}</h1>
                    {% if page.description %}
                    <p class="page-description">{{ page.description }}</p>
                    {% endif %}
                </div>

                <!-- Prawa kolumna: Timer zako≈Ñczenia -->
                <div class="header-right">
                    {% if page.ends_at %}
                    <div class="deadline-banner" data-deadline="{{ page.ends_at.isoformat() }}">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71V3.5z"/>
                            <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0z"/>
                        </svg>
                        <span>Koniec zam√≥wie≈Ñ: <strong>{{ page.ends_at|format_datetime('%d.%m.%Y, %H:%M') }}</strong></span>
                    </div>

                    <!-- Dynamiczny licznik (pojawia siƒô gdy <10 minut) -->
                    <div id="dynamicCountdown" class="deadline-countdown hidden">
                        <svg width="18" height="18" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71V3.5z"/>
                            <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0z"/>
                        </svg>
                        <span>Do ko≈Ñca: <strong id="countdownTime">--:--</strong></span>
                    </div>
                    {% else %}
                    <div class="deadline-banner deadline-unknown">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                            <path d="M5.255 5.786a.237.237 0 0 0 .241.247h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286zm1.557 5.763c0 .533.425.927 1.01.927.609 0 1.028-.394 1.028-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94z"/>
                        </svg>
                        <span>Data zako≈Ñczenia nieznana - <strong>≈õpiesz siƒô!</strong></span>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="page-content">
        <main class="sections-list">
            {% for section in sections %}
                {% if section.is_heading %}
                <section class="section section-heading">
                    <h2>{{ section.content }}</h2>
                </section>

                {% elif section.is_paragraph %}
                <section class="section section-paragraph">
                    <p>{{ section.content }}</p>
                </section>

                {% elif section.is_product %}
                <section class="section section-product" data-section-id="{{ section.id }}" data-product-id="{{ section.product_id }}">
                    {% if section.product %}
                    <!-- Header z nazwƒÖ produktu -->
                    <div class="product-header">
                        <h3 class="product-name">{{ section.product.name }}</h3>
                        {% if section.has_min_quantity or section.has_max_quantity %}
                        <div class="product-limits">
                            {% if section.has_min_quantity %}
                            <span class="limit-badge limit-min">Min: {{ section.min_quantity }}</span>
                            {% endif %}
                            {% if section.has_max_quantity %}
                            <span class="limit-badge limit-max">Max: {{ section.max_quantity }}</span>
                            {% endif %}
                        </div>
                        {% endif %}
                    </div>
                    <!-- Body: obrazek wycentrowany + kontrolki po prawej -->
                    <div class="product-body">
                        <div class="product-image-area">
                            {% if section.product.primary_image %}
                            <div class="zoomable-image-wrapper" onclick="openLightbox(this)">
                                <img src="{{ url_for('static', filename=section.product.primary_image.path_compressed) }}"
                                     alt="{{ section.product.name }}" class="product-image-centered"
                                     data-full-src="{{ url_for('static', filename=section.product.primary_image.path_original or section.product.primary_image.path_compressed) }}">
                                <div class="zoom-icon">
                                    <svg viewBox="0 0 16 16" fill="currentColor">
                                        <path fill-rule="evenodd" d="M6.5 12a5.5 5.5 0 1 0 0-11 5.5 5.5 0 0 0 0 11zM13 6.5a6.5 6.5 0 1 1-13 0 6.5 6.5 0 0 1 13 0z"/>
                                        <path d="M10.344 11.742c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1 6.538 6.538 0 0 1-1.398 1.4z"/>
                                        <path fill-rule="evenodd" d="M6.5 3a.5.5 0 0 1 .5.5V6h2.5a.5.5 0 0 1 0 1H7v2.5a.5.5 0 0 1-1 0V7H3.5a.5.5 0 0 1 0-1H6V3.5a.5.5 0 0 1 .5-.5z"/>
                                    </svg>
                                </div>
                            </div>
                            {% else %}
                            <div class="no-image">
                                <svg width="64" height="64" viewBox="0 0 16 16" fill="currentColor">
                                    <path d="M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/>
                                    <path d="M2.002 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2h-12zm12 1a1 1 0 0 1 1 1v6.5l-3.777-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12V3a1 1 0 0 1 1-1h12z"/>
                                </svg>
                            </div>
                            {% endif %}
                        </div>
                        <div class="product-controls-box">
                            <p class="product-price">{{ "%.2f"|format(section.product.sale_price) }} PLN</p>
                            <div class="quantity-wrapper">
                                <div class="quantity-control">
                                    <button type="button" class="qty-btn qty-minus" onclick="decreaseQty(this)">-</button>
                                    <input type="number" class="qty-input" value="0" min="0"
                                           {% if section.has_max_quantity %}max="{{ section.max_quantity }}"{% endif %}
                                           onchange="updateQty(this)">
                                    <button type="button" class="qty-btn qty-plus" onclick="increaseQty(this)">+</button>
                                </div>
                                <span class="availability-info availability-loading" data-availability-for="{{ section.product_id }}">≈Åadowanie</span>
                            </div>
                        </div>
                    </div>
                    {% else %}
                    <div class="product-unavailable">
                        <p>Produkt niedostƒôpny</p>
                    </div>
                    {% endif %}
                </section>

                {% elif section.is_set %}
                <section class="section section-set" data-section-id="{{ section.id }}" data-set-max="{{ section.set_max_sets or 0 }}">
                    <div class="set-card {% if section.set_image %}has-image{% endif %}">
                        <div class="set-content">
                            <div class="set-header">
                                <h3 class="set-name">{{ section.set_name }}</h3>
                                {% if section.set_max_sets %}
                                <div class="set-limits">
                                    <span class="limit-badge limit-max">Max set√≥w: {{ section.set_max_sets }}</span>
                                </div>
                                {% endif %}
                            </div>

                            {% if section.set_image %}
                            <!-- T≈Ço seta -->
                            <div class="set-background expandable-image collapsed" onclick="toggleSetImage(this)">
                                <div class="image-wrapper">
                                    <img src="{{ url_for('static', filename=section.set_image) }}" alt="{{ section.set_name }}">
                                </div>
                                <div class="expand-overlay">
                                    <span class="expand-text">Poka≈º ca≈Çy obraz</span>
                                </div>
                            </div>
                            {% endif %}

                            <div class="set-items">
                                {% for item in section.get_set_items_ordered() %}
                                    {% if item.is_product and item.product %}
                                    <!-- Pojedynczy produkt -->
                                    <div class="set-item" data-item-id="{{ item.id }}" data-product-id="{{ item.product_id }}">
                                        <div class="set-item-info">
                                            <span class="set-item-name">{{ item.product.name }}</span>
                                        </div>
                                        <div class="set-item-qty">
                                            <span class="set-item-price">{{ "%.2f"|format(item.product.sale_price) }} PLN</span>
                                            <div class="quantity-wrapper">
                                                <div class="quantity-control quantity-control-sm">
                                                    <button type="button" class="qty-btn qty-minus" onclick="decreaseQty(this)">-</button>
                                                    <input type="number" class="qty-input" value="0" min="0" onchange="updateQty(this)">
                                                    <button type="button" class="qty-btn qty-plus" onclick="increaseQty(this)">+</button>
                                                </div>
                                                <span class="availability-info availability-loading" data-availability-for="{{ item.product_id }}">≈Åadowanie</span>
                                            </div>
                                        </div>
                                    </div>
                                    {% elif item.is_variant_group and item.variant_group %}
                                    <!-- Grupa wariantowa w secie -->
                                    <div class="set-item-group" data-item-id="{{ item.id }}" data-variant-group-id="{{ item.variant_group_id }}">
                                        {% for product in item.get_products() %}
                                        <div class="set-item" data-product-id="{{ product.id }}">
                                            <div class="set-item-info">
                                                <span class="set-item-name">{{ product.name }}</span>
                                            </div>
                                            <div class="set-item-qty">
                                                <span class="set-item-price">{{ "%.2f"|format(product.sale_price) }} PLN</span>
                                                <div class="quantity-wrapper">
                                                    <div class="quantity-control quantity-control-sm">
                                                        <button type="button" class="qty-btn qty-minus" onclick="decreaseQty(this)">-</button>
                                                        <input type="number" class="qty-input" value="0" min="0" onchange="updateQty(this)">
                                                        <button type="button" class="qty-btn qty-plus" onclick="increaseQty(this)">+</button>
                                                    </div>
                                                    <span class="availability-info availability-loading" data-availability-for="{{ product.id }}">≈Åadowanie</span>
                                                </div>
                                            </div>
                                        </div>
                                        {% endfor %}
                                    </div>
                                    {% endif %}
                                {% endfor %}
                            </div>

                            <!-- KUP PE≈ÅNY SET - Produkt komplet -->
                            {% if section.set_product %}
                            {% set set_product = section.set_product %}
                            <div class="full-set-section"
                                 data-section-id="{{ section.id }}"
                                 data-set-name="{{ set_product.name }}"
                                 data-set-price="{{ set_product.sale_price }}"
                                 data-product-id="{{ set_product.id }}">
                                <div class="full-set-confetti-container">
                                    <div class="full-set-inner">
                                        <div class="full-set-info">
                                            <span class="full-set-icon">‚ú®</span>
                                            <div class="full-set-title-big">KUP PE≈ÅNY SET</div>
                                        </div>
                                        <span class="full-set-price">{{ "%.2f"|format(set_product.sale_price) }} PLN</span>
                                        <div class="full-set-controls">
                                            <div class="quantity-control full-set-quantity">
                                                <button type="button" class="qty-btn qty-minus" onclick="decreaseFullSet(this)">-</button>
                                                <input type="number" class="qty-input full-set-qty-input" value="0" min="0" data-section-id="{{ section.id }}" onchange="updateFullSetQty(this)">
                                                <button type="button" class="qty-btn qty-plus full-set-plus-btn" onclick="increaseFullSet(this)">+</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </section>

                {% elif section.is_variant_group %}
                <section class="section section-variant-group" data-section-id="{{ section.id }}">
                    {% if section.variant_group %}
                    <div class="variant-group-card">
                        <div class="set-header">
                            <h3 class="set-name">{{ section.variant_group.name }}</h3>
                            {% if section.has_min_quantity or section.has_max_quantity %}
                            <div class="set-limits">
                                {% if section.has_min_quantity %}
                                <span class="limit-badge limit-min">Min/produkt: {{ section.min_quantity }}</span>
                                {% endif %}
                                {% if section.has_max_quantity %}
                                <span class="limit-badge limit-max">Max/produkt: {{ section.max_quantity }}</span>
                                {% endif %}
                            </div>
                            {% endif %}
                        </div>

                        <div class="variant-group-products">
                            {% for product in section.get_variant_group_products() %}
                            {% if product.is_active %}
                            <div class="variant-product" data-product-id="{{ product.id }}">
                                <div class="variant-product-image {% if product.primary_image %}zoomable-image-wrapper{% endif %}" {% if product.primary_image %}onclick="openLightbox(this)"{% endif %}>
                                    {% if product.primary_image %}
                                    <img src="{{ url_for('static', filename=product.primary_image.path_compressed) }}"
                                         alt="{{ product.name }}"
                                         data-full-src="{{ url_for('static', filename=product.primary_image.path_original or product.primary_image.path_compressed) }}">
                                    <div class="zoom-icon zoom-icon-sm">
                                        <svg viewBox="0 0 16 16" fill="currentColor">
                                            <path fill-rule="evenodd" d="M6.5 12a5.5 5.5 0 1 0 0-11 5.5 5.5 0 0 0 0 11zM13 6.5a6.5 6.5 0 1 1-13 0 6.5 6.5 0 0 1 13 0z"/>
                                            <path d="M10.344 11.742c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1 6.538 6.538 0 0 1-1.398 1.4z"/>
                                            <path fill-rule="evenodd" d="M6.5 3a.5.5 0 0 1 .5.5V6h2.5a.5.5 0 0 1 0 1H7v2.5a.5.5 0 0 1-1 0V7H3.5a.5.5 0 0 1 0-1H6V3.5a.5.5 0 0 1 .5-.5z"/>
                                        </svg>
                                    </div>
                                    {% else %}
                                    <div class="no-image-sm">
                                        <svg width="24" height="24" viewBox="0 0 16 16" fill="currentColor">
                                            <path d="M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/>
                                            <path d="M2.002 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2h-12zm12 1a1 1 0 0 1 1 1v6.5l-3.777-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12V3a1 1 0 0 1 1-1h12z"/>
                                        </svg>
                                    </div>
                                    {% endif %}
                                </div>
                                <div class="variant-product-info">
                                    <span class="variant-product-name">{{ product.name }}</span>
                                    <span class="variant-product-price">{{ "%.2f"|format(product.sale_price) }} PLN</span>
                                </div>
                                <div class="variant-product-qty">
                                    <div class="quantity-wrapper">
                                        <div class="quantity-control quantity-control-sm">
                                            <button type="button" class="qty-btn qty-minus" onclick="decreaseQty(this)">-</button>
                                            <input type="number" class="qty-input" value="0" min="0"
                                                   {% if section.has_max_quantity %}max="{{ section.max_quantity }}"{% endif %}
                                                   onchange="updateQty(this)">
                                            <button type="button" class="qty-btn qty-plus" onclick="increaseQty(this)">+</button>
                                        </div>
                                        <span class="availability-info availability-loading" data-availability-for="{{ product.id }}">≈Åadowanie</span>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                    {% else %}
                    <div class="product-unavailable">
                        <p>Grupa wariantowa niedostƒôpna</p>
                    </div>
                    {% endif %}
                </section>
                {% endif %}
            {% endfor %}
        </main>

        <!-- Cart Sidebar -->
        <aside class="cart-sidebar">
            <div class="cart-header">
                <h3>Twoje zam√≥wienie</h3>
                <span class="cart-count" id="cartCount">0</span>
            </div>

            <div class="cart-items" id="cartItems">
                <div class="cart-empty">
                    <p>Koszyk jest pusty</p>
                </div>
            </div>

            <div class="cart-footer">
                <div class="cart-total">
                    <span>Suma:</span>
                    <span class="total-amount" id="cartTotal">0.00 PLN</span>
                </div>

                <button type="button" class="btn btn-primary btn-block" id="submitOrderBtn" disabled onclick="openOrderModal()">
                    Z≈Ç√≥≈º zam√≥wienie
                </button>
            </div>
        </aside>
    </div>

    <!-- Footer -->
    {% if page.footer_content %}
    <footer class="page-footer">
        <div class="footer-content">
            {{ page.footer_content|safe }}
        </div>
    </footer>
    {% endif %}
</div>

<!-- Guest Choice Modal - Wyb√≥r dla go≈õcia -->
<div id="guestChoiceModal" class="exclusive-modal-overlay">
    <div class="exclusive-modal-box exclusive-modal-choice">
        <!-- Close Button -->
        <button type="button" class="exclusive-modal-close-btn" onclick="closeGuestChoiceModal()">
            <svg width="24" height="24" viewBox="0 0 16 16" fill="currentColor">
                <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/>
            </svg>
        </button>

        <!-- Header -->
        <div class="exclusive-modal-header">
            <div class="exclusive-modal-sparkle">‚ú®</div>
            <h2 class="exclusive-modal-title">Z≈Ç√≥≈º zam√≥wienie</h2>
            <p class="exclusive-modal-subtitle">Jak chcesz kontynuowaƒá?</p>
        </div>

        <!-- Body -->
        <div class="exclusive-modal-body">
            <div class="guest-choice-options">
                <!-- Option 1: Guest Checkout -->
                <button type="button" class="guest-choice-btn" onclick="continueAsGuest()">
                    <div class="guest-choice-icon">
                        <svg width="32" height="32" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10z"/>
                        </svg>
                    </div>
                    <div class="guest-choice-content">
                        <h3 class="guest-choice-title">Kontynuuj jako go≈õƒá</h3>
                        <p class="guest-choice-desc">Szybkie zam√≥wienie bez zak≈Çadania konta</p>
                    </div>
                    <div class="guest-choice-arrow">‚Üí</div>
                </button>

                <!-- Option 2: Login -->
                <button type="button" class="guest-choice-btn" onclick="showLoginModal()">
                    <div class="guest-choice-icon">
                        <svg width="32" height="32" viewBox="0 0 16 16" fill="currentColor">
                            <path fill-rule="evenodd" d="M6 3.5a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-2a.5.5 0 0 0-1 0v2A1.5 1.5 0 0 0 6.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-8A1.5 1.5 0 0 0 5 3.5v2a.5.5 0 0 0 1 0v-2z"/>
                            <path fill-rule="evenodd" d="M11.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 1 0-.708.708L10.293 7.5H1.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3z"/>
                        </svg>
                    </div>
                    <div class="guest-choice-content">
                        <h3 class="guest-choice-title">Zaloguj siƒô</h3>
                        <p class="guest-choice-desc">Masz ju≈º konto? Zaloguj siƒô</p>
                    </div>
                    <div class="guest-choice-arrow">‚Üí</div>
                </button>
            </div>

            <!-- Create Account Link -->
            <div class="guest-choice-footer">
                <p class="guest-choice-register-text">
                    Nie masz jeszcze konta?
                    <a href="/auth/register" class="guest-choice-register-link">Utw√≥rz konto</a>
                </p>
            </div>
        </div>
    </div>
</div>

<!-- Login Modal -->
<div id="loginModal" class="exclusive-modal-overlay">
    <div class="exclusive-modal-box exclusive-modal-login">
        <!-- Close Button -->
        <button type="button" class="exclusive-modal-close-btn" onclick="closeLoginModal()">
            <svg width="24" height="24" viewBox="0 0 16 16" fill="currentColor">
                <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/>
            </svg>
        </button>

        <!-- Header -->
        <div class="exclusive-modal-header">
            <div class="exclusive-modal-sparkle">üîê</div>
            <h2 class="exclusive-modal-title">Zaloguj siƒô</h2>
            <p class="exclusive-modal-subtitle">Kontynuuj jako zalogowany u≈ºytkownik</p>
        </div>

        <!-- Body -->
        <div class="exclusive-modal-body">
            <form id="loginForm" onsubmit="handleLogin(event)">
                <div class="exclusive-form-field">
                    <label class="exclusive-form-label">Email <span class="exclusive-req">*</span></label>
                    <input type="email" id="loginEmail" class="exclusive-form-input" required placeholder="twoj.email@example.com" autocomplete="email">
                </div>

                <div class="exclusive-form-field">
                    <label class="exclusive-form-label">Has≈Ço <span class="exclusive-req">*</span></label>
                    <input type="password" id="loginPassword" class="exclusive-form-input" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password">
                </div>

                <div id="loginError" class="exclusive-form-error" style="display: none;"></div>

                <!-- Footer -->
                <div class="exclusive-modal-footer">
                    <button type="button" class="exclusive-btn-cancel" onclick="backToGuestChoice()">
                        <svg width="18" height="18" viewBox="0 0 16 16" fill="currentColor">
                            <path fill-rule="evenodd" d="M12 8a.5.5 0 0 1-.5.5H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H11.5a.5.5 0 0 1 .5.5z"/>
                        </svg>
                        <span>Wr√≥ƒá</span>
                    </button>
                    <button type="submit" class="exclusive-btn-submit" id="loginSubmitBtn">
                        <svg width="18" height="18" viewBox="0 0 16 16" fill="currentColor">
                            <path fill-rule="evenodd" d="M6 3.5a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-2a.5.5 0 0 0-1 0v2A1.5 1.5 0 0 0 6.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-8A1.5 1.5 0 0 0 5 3.5v2a.5.5 0 0 0 1 0v-2z"/>
                            <path fill-rule="evenodd" d="M11.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 1 0-.708.708L10.293 7.5H1.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3z"/>
                        </svg>
                        <span>Zaloguj siƒô</span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Order Modal - K-pop Style -->
<div id="orderModal" class="exclusive-modal-overlay">
    <div class="exclusive-modal-box">
        <!-- Close Button -->
        <button type="button" class="exclusive-modal-close-btn" onclick="closeOrderModal()">
            <svg width="24" height="24" viewBox="0 0 16 16" fill="currentColor">
                <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/>
            </svg>
        </button>

        <!-- Header -->
        <div class="exclusive-modal-header">
            <div class="exclusive-modal-sparkle">‚ú®</div>
            <h2 class="exclusive-modal-title">Z≈Ç√≥≈º zam√≥wienie</h2>
            <p class="exclusive-modal-subtitle">Jeszcze tylko krok!</p>
        </div>

        <!-- Body -->
        <div class="exclusive-modal-body">
            {% if current_user.is_authenticated %}
            <!-- Logged in user -->
            <div class="exclusive-user-card">
                <div class="exclusive-user-avatar">
                    {% if current_user.avatar_url %}
                    <img src="{{ current_user.avatar_url }}" alt="{{ current_user.full_name }}" class="user-avatar-img">
                    {% else %}
                    <svg width="28" height="28" viewBox="0 0 16 16" fill="currentColor">
                        <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"/>
                        <path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z"/>
                    </svg>
                    {% endif %}
                </div>
                <div class="exclusive-user-info">
                    <p class="exclusive-user-name">{{ current_user.full_name }}</p>
                    <p class="exclusive-user-email">{{ current_user.email }}</p>
                </div>
            </div>

            <div class="exclusive-form-field">
                <label class="exclusive-form-label">
                    <svg width="18" height="18" viewBox="0 0 16 16" fill="currentColor">
                        <path d="M5 4a.5.5 0 0 0 0 1h6a.5.5 0 0 0 0-1H5zm-.5 2.5A.5.5 0 0 1 5 6h6a.5.5 0 0 1 0 1H5a.5.5 0 0 1-.5-.5zM5 8a.5.5 0 0 0 0 1h6a.5.5 0 0 0 0-1H5zm0 2a.5.5 0 0 0 0 1h3a.5.5 0 0 0 0-1H5z"/>
                        <path d="M2 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2zm10-1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1z"/>
                    </svg>
                    <span>Notatka do zam√≥wienia <span class="exclusive-opt">(opcjonalnie)</span></span>
                </label>
                <textarea id="orderNote" class="exclusive-form-textarea" rows="3" placeholder="Dodatkowe informacje, uwagi, preferencje..."></textarea>
            </div>
            {% else %}
            <!-- Guest checkout -->
            <form id="guestForm">
                <div class="exclusive-guest-badge">
                    <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor">
                        <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10z"/>
                    </svg>
                    <span>Twoje dane</span>
                </div>

                <div class="exclusive-form-field">
                    <label class="exclusive-form-label">Imiƒô i nazwisko <span class="exclusive-req">*</span></label>
                    <input type="text" id="guestName" class="exclusive-form-input" required placeholder="Jan Kowalski">
                </div>

                <div class="exclusive-form-field">
                    <label class="exclusive-form-label">Email <span class="exclusive-req">*</span></label>
                    <input type="email" id="guestEmail" class="exclusive-form-input" required placeholder="jan.kowalski@example.com">
                </div>

                <div class="exclusive-form-field">
                    <label class="exclusive-form-label">Telefon <span class="exclusive-req">*</span></label>
                    <input type="tel" id="guestPhone" class="exclusive-form-input" required placeholder="+48 123 456 789">
                </div>

                <div class="exclusive-form-field">
                    <label class="exclusive-form-label">
                        <svg width="18" height="18" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M5 4a.5.5 0 0 0 0 1h6a.5.5 0 0 0 0-1H5zm-.5 2.5A.5.5 0 0 1 5 6h6a.5.5 0 0 1 0 1H5a.5.5 0 0 1-.5-.5zM5 8a.5.5 0 0 0 0 1h6a.5.5 0 0 0 0-1H5zm0 2a.5.5 0 0 0 0 1h3a.5.5 0 0 0 0-1H5z"/>
                            <path d="M2 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2zm10-1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1z"/>
                        </svg>
                        <span>Notatka <span class="exclusive-opt">(opcjonalnie)</span></span>
                    </label>
                    <textarea id="orderNote" class="exclusive-form-textarea" rows="3" placeholder="Dodatkowe informacje, uwagi, preferencje..."></textarea>
                </div>
            </form>
            {% endif %}
        </div>

        <!-- Footer -->
        <div class="exclusive-modal-footer">
            <button type="button" class="exclusive-btn-cancel" onclick="closeOrderModal()">
                <svg width="18" height="18" viewBox="0 0 16 16" fill="currentColor">
                    <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/>
                </svg>
                <span>Anuluj</span>
            </button>
            <button type="button" class="exclusive-btn-submit" onclick="submitOrder()">
                <svg width="18" height="18" viewBox="0 0 16 16" fill="currentColor">
                    <path d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.267.267 0 0 1 .02-.022z"/>
                </svg>
                <span>Potwierd≈∫ zam√≥wienie</span>
            </button>
        </div>
    </div>
</div>

<!-- Success Modal -->
<div id="successModal" class="exclusive-modal-overlay">
    <div class="exclusive-modal-box exclusive-modal-success">
        <!-- Success Icon -->
        <div class="exclusive-success-icon">
            <svg width="64" height="64" viewBox="0 0 16 16" fill="currentColor">
                <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>
            </svg>
        </div>

        <!-- Header -->
        <div class="exclusive-modal-header">
            <h2 class="exclusive-modal-title">Zam√≥wienie zosta≈Ço z≈Ço≈ºone!</h2>
            <p class="exclusive-modal-subtitle">Dziƒôkujemy za zakupy ‚ú®</p>
        </div>

        <!-- Body -->
        <div class="exclusive-modal-body">
            <div class="exclusive-success-info">
                <div class="exclusive-success-row">
                    <span class="exclusive-success-label">Numer zam√≥wienia:</span>
                    <span class="exclusive-success-value" id="successOrderNumber">-</span>
                </div>
                <div class="exclusive-success-row">
                    <span class="exclusive-success-label">Kwota:</span>
                    <span class="exclusive-success-value" id="successOrderTotal">-</span>
                </div>
            </div>

            <div class="exclusive-success-message">
                {% if current_user.is_authenticated %}
                <p>Szczeg√≥≈Çy zam√≥wienia znajdziesz w swoim panelu klienta.</p>
                {% else %}
                <p>Potwierdzenie zam√≥wienia zosta≈Ço wys≈Çane na podany adres email.</p>
                <p class="exclusive-success-note">Sprawd≈∫ swojƒÖ skrzynkƒô odbiorczƒÖ (oraz folder spam).</p>
                {% endif %}
            </div>
        </div>

        <!-- Footer -->
        <div class="exclusive-modal-footer">
            {% if current_user.is_authenticated %}
            <button type="button" class="exclusive-btn-submit" onclick="redirectToOrders()">
                <svg width="18" height="18" viewBox="0 0 16 16" fill="currentColor">
                    <path fill-rule="evenodd" d="M4.146 3.646a.5.5 0 0 0 0 .708L7.793 8l-3.647 3.646a.5.5 0 0 0 .708.708l4-4a.5.5 0 0 0 0-.708l-4-4a.5.5 0 0 0-.708 0z"/>
                </svg>
                <span>Przejd≈∫ do moich zam√≥wie≈Ñ</span>
            </button>
            {% else %}
            <button type="button" class="exclusive-btn-submit" onclick="closeSuccessModal()">
                <svg width="18" height="18" viewBox="0 0 16 16" fill="currentColor">
                    <path d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.267.267 0 0 1 .02-.022z"/>
                </svg>
                <span>OK</span>
            </button>
            {% endif %}
        </div>
    </div>
</div>

<!-- Email Exists Modal - shown when guest email already has an account -->
<div id="emailExistsModal" class="exclusive-modal-overlay">
    <div class="exclusive-modal-box">
        <!-- Warning Icon -->
        <div class="exclusive-warning-icon">
            <svg width="48" height="48" viewBox="0 0 16 16" fill="currentColor">
                <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
            </svg>
        </div>

        <!-- Header -->
        <div class="exclusive-modal-header">
            <h2 class="exclusive-modal-title">Konto ju≈º istnieje</h2>
        </div>

        <!-- Body -->
        <div class="exclusive-modal-body">
            <p id="emailExistsMessage" class="exclusive-modal-message">
                Konto z tym adresem email ju≈º istnieje. Zaloguj siƒô, aby z≈Ço≈ºyƒá zam√≥wienie.
            </p>
            <p class="exclusive-modal-hint">
                Po zalogowaniu wr√≥cisz na tƒô stronƒô i bƒôdziesz m√≥g≈Ç doko≈Ñczyƒá zam√≥wienie.
            </p>
        </div>

        <!-- Footer -->
        <div class="exclusive-modal-footer exclusive-modal-footer-split">
            <button type="button" class="exclusive-btn-secondary" onclick="closeEmailExistsModal()">
                Anuluj
            </button>
            <button type="button" class="exclusive-btn-submit" onclick="redirectToLogin()">
                <svg width="18" height="18" viewBox="0 0 16 16" fill="currentColor">
                    <path fill-rule="evenodd" d="M6 3.5a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-2a.5.5 0 0 0-1 0v2A1.5 1.5 0 0 0 6.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-8A1.5 1.5 0 0 0 5 3.5v2a.5.5 0 0 0 1 0v-2z"/>
                    <path fill-rule="evenodd" d="M11.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 1 0-.708.708L10.293 7.5H1.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3z"/>
                </svg>
                <span>Zaloguj siƒô</span>
            </button>
        </div>
    </div>
</div>

<!-- Image Lightbox Modal -->
<div id="imageLightbox" class="image-lightbox">
    <div class="image-lightbox-overlay" onclick="closeLightbox()"></div>
    <button class="image-lightbox-close" onclick="closeLightbox()">
        <svg viewBox="0 0 16 16" fill="currentColor">
            <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/>
        </svg>
    </button>
    <div class="image-lightbox-content">
        <img id="lightboxImage" class="image-lightbox-img" src="" alt="">
    </div>
</div>

<!-- Deadline Alert Popup -->
<div id="deadlineAlertPopup" class="deadline-alert-overlay hidden">
    <div class="deadline-alert-modal">
        <!-- Icon -->
        <div class="deadline-alert-icon">
            <svg width="60" height="60" viewBox="0 0 16 16" fill="currentColor">
                <path d="M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71V3.5z"/>
                <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0z"/>
            </svg>
        </div>

        <!-- Message -->
        <h2 class="deadline-alert-title">Uwaga! Czas ucieka!</h2>
        <p class="deadline-alert-message" id="deadlineAlertMessage">
            Do zamkniƒôcia sprzeda≈ºy zosta≈Ço <strong id="deadlineMinutes">10 minut</strong>!
        </p>

        <!-- Button -->
        <button type="button" class="deadline-alert-btn" onclick="closeDeadlineAlert()">
            <span>JU≈ª KUPUJƒò!</span>
            <svg width="18" height="18" viewBox="0 0 16 16" fill="currentColor">
                <path fill-rule="evenodd" d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8z"/>
            </svg>
        </button>
    </div>
</div>

<!-- Notification Subscription Modal -->
<div id="notificationModal" class="exclusive-modal-overlay">
    <div class="exclusive-modal-box exclusive-modal-notification">
        <!-- Close button -->
        <button type="button" class="exclusive-modal-close-btn" onclick="closeNotificationModal()">
            <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor">
                <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/>
            </svg>
        </button>

        <!-- Header with bell icon -->
        <div class="exclusive-modal-header">
            <div class="exclusive-modal-sparkle notification-bell-icon-modal">
                <svg width="32" height="32" viewBox="0 0 16 16" fill="currentColor">
                    <path d="M8 16a2 2 0 0 0 2-2H6a2 2 0 0 0 2 2zM8 1.918l-.797.161A4.002 4.002 0 0 0 4 6c0 .628-.134 2.197-.459 3.742-.16.767-.376 1.566-.663 2.258h10.244c-.287-.692-.502-1.49-.663-2.258C12.134 8.197 12 6.628 12 6a4.002 4.002 0 0 0-3.203-3.92L8 1.917zM14.22 12c.223.447.481.801.78 1H1c.299-.199.557-.553.78-1C2.68 10.2 3 6.88 3 6c0-2.42 1.72-4.44 4.005-4.901a1 1 0 1 1 1.99 0A5.002 5.002 0 0 1 13 6c0 .88.32 4.2 1.22 6z"/>
                </svg>
            </div>
            <h2 class="exclusive-modal-title">Powiadom mnie</h2>
            <p class="exclusive-modal-subtitle" id="notificationProductName">o dostƒôpno≈õci produktu</p>
        </div>

        <!-- Body -->
        <div class="exclusive-modal-body">
            {% if current_user.is_authenticated %}
            <!-- Logged in user -->
            <p class="exclusive-modal-message">
                Gdy produkt stanie siƒô dostƒôpny, wy≈õlemy jednorazowe powiadomienie na adres:
            </p>
            <p class="notification-email-display">{{ current_user.email }}</p>
            {% else %}
            <!-- Guest user -->
            <p class="exclusive-modal-message">
                Podaj sw√≥j adres email, a powiadomimy Ciƒô gdy produkt stanie siƒô dostƒôpny.
            </p>
            <div class="notification-form-group">
                <label for="notificationEmail">Adres email</label>
                <input type="email" id="notificationEmail" class="exclusive-input" placeholder="twoj@email.pl" required>
                <span id="notificationEmailError" class="notification-error hidden"></span>
            </div>
            {% endif %}

            <p class="notification-hint">
                Powiadomienie jest jednorazowe - po wys≈Çaniu automatycznie usuwamy Twoje dane.
            </p>
        </div>

        <!-- Footer -->
        <div class="exclusive-modal-footer">
            <button type="button" class="exclusive-btn-submit notification-submit-btn" id="notificationSubmitBtn" onclick="submitNotificationSubscription()">
                <svg width="18" height="18" viewBox="0 0 16 16" fill="currentColor">
                    <path d="M8 16a2 2 0 0 0 2-2H6a2 2 0 0 0 2 2zM8 1.918l-.797.161A4.002 4.002 0 0 0 4 6c0 .628-.134 2.197-.459 3.742-.16.767-.376 1.566-.663 2.258h10.244c-.287-.692-.502-1.49-.663-2.258C12.134 8.197 12 6.628 12 6a4.002 4.002 0 0 0-3.203-3.92L8 1.917zM14.22 12c.223.447.481.801.78 1H1c.299-.199.557-.553.78-1C2.68 10.2 3 6.88 3 6c0-2.42 1.72-4.44 4.005-4.901a1 1 0 1 1 1.99 0A5.002 5.002 0 0 1 13 6c0 .88.32 4.2 1.22 6z"/>
                </svg>
                <span>Powiadom mnie</span>
            </button>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
// ============================================
// Configuration (from template)
// ============================================
window.isAuthenticated = {{ 'true' if current_user.is_authenticated else 'false' }};
window.isGuest = {{ 'false' if current_user.is_authenticated else 'true' }};

// Google Analytics - Exclusive page info
window.exclusiveToken = '{{ page.token }}';
window.exclusiveName = '{{ page.name }}';

// URLs
window.placeOrderUrl = '/exclusive/{{ page.token }}/place-order';
window.thankYouUrl = '/exclusive/{{ page.token }}/thank-you';
window.reserveProductUrl = '/exclusive/{{ page.token }}/reserve';
window.releaseProductUrl = '/exclusive/{{ page.token }}/release';
window.restoreReservationUrl = '/exclusive/{{ page.token }}/restore';
window.extendReservationUrl = '/exclusive/{{ page.token }}/extend';
window.subscribeNotificationUrl = '/exclusive/{{ page.token }}/subscribe-notification';

// Dynamic URL (function to get current sessionId)
window.getAvailabilityCheckUrl = function() {
    let sessionId = '';
    const stored = window.localStorage.getItem('exclusive_reservation_{{ page.token }}');
    if (stored) {
        try {
            sessionId = JSON.parse(stored).sessionId || '';
        } catch (e) {}
    }
    return `/exclusive/{{ page.token }}/availability?session_id=${sessionId}`;
};

// Storage keys
window.reservationStorageKey = 'exclusive_reservation_{{ page.token }}';

// Redirect URL after order
{% if current_user.is_authenticated %}
    {% if current_user.role in ['admin', 'mod'] %}
window.redirectAfterOrderUrl = '/admin/dashboard';
    {% else %}
window.redirectAfterOrderUrl = '/client/dashboard';
    {% endif %}
{% else %}
window.redirectAfterOrderUrl = '#'; // Guest - will just close modal
{% endif %}

// Auto-refresh when sale ends (if applicable)
{% if page.ends_at and not preview_mode %}
(function() {
    const endDate = new Date('{{ page.ends_at.isoformat() }}').getTime();
    const orderPageUrl = '{{ url_for("exclusive.order_page", token=page.token) }}';

    function checkSaleEnd() {
        const now = new Date().getTime();
        if (now >= endDate) {
            window.location.href = orderPageUrl;
        }
    }

    setInterval(checkSaleEnd, 1000);
    checkSaleEnd();
})();
{% endif %}
</script>

<!-- Load external JavaScript -->
<script src="{{ url_for('static', filename='js/pages/exclusive/order-page.js') }}"></script>
{% endblock %}
