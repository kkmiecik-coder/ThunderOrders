<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Podsumowanie zam√≥wienia - ThunderOrders</title>
</head>
<body style="margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif; background-color: #F5F5F5; line-height: 1.6;">
    <!-- Outer wrapper for centering -->
    <table width="100%" cellpadding="0" cellspacing="0" border="0" style="background-color: #F5F5F5; padding: 40px 20px;">
        <tr>
            <td align="center">
                <!-- Main email container (max-width: 600px) -->
                <table width="600" cellpadding="0" cellspacing="0" border="0" style="max-width: 600px; width: 100%; background-color: #FFFFFF; border-radius: 8px; overflow: hidden;">

                    <!-- Header with logo -->
                    <tr>
                        <td align="center" style="padding: 40px 40px 20px 40px;">
                            <img src="cid:logo@thunderorders" alt="ThunderOrders" style="height: 40px; width: auto; display: block;" />
                        </td>
                    </tr>

                    <!-- Main content -->
                    <tr>
                        <td style="padding: 20px 40px;">
                            <h1 style="margin: 0 0 20px 0; font-size: 24px; font-weight: 700; color: #240046; text-align: left;">
                                Podsumowanie Twojego zam√≥wienia
                            </h1>

                            <p style="margin: 0 0 16px 0; font-size: 16px; color: #212121;">
                                Cze≈õƒá <strong>{{ customer_name }}</strong>!
                            </p>

                            <p style="margin: 0 0 20px 0; font-size: 16px; color: #212121;">
                                Sprzeda≈º na stronie <strong>{{ page_name }}</strong> zosta≈Ça zako≈Ñczona.
                                Poni≈ºej znajdziesz podsumowanie Twojego zam√≥wienia wraz z informacjƒÖ, kt√≥re produkty zosta≈Çy zakwalifikowane do setu.
                            </p>

                            <!-- Page name banner -->
                            <table width="100%" cellpadding="0" cellspacing="0" border="0" style="margin: 20px 0;">
                                <tr>
                                    <td style="background: linear-gradient(135deg, #7B2CBF, #9D4EDD); color: #FFFFFF; padding: 16px 20px; border-radius: 8px; text-align: center; font-size: 18px; font-weight: 700;">
                                        {{ page_name }}
                                    </td>
                                </tr>
                            </table>

                            <!-- Order number -->
                            {% if order_number %}
                            <p style="margin: 20px 0 10px 0; font-size: 14px; color: #616161;">
                                Numer zam√≥wienia: <strong style="color: #240046;">{{ order_number }}</strong>
                            </p>
                            {% endif %}

                            <h2 style="margin: 30px 0 16px 0; font-size: 18px; font-weight: 600; color: #240046;">
                                Twoje produkty
                            </h2>

                            <!-- Products table -->
                            <table width="100%" cellpadding="0" cellspacing="0" border="0" style="margin: 20px 0; border-collapse: collapse;">
                                <thead>
                                    <tr>
                                        <th style="background-color: #240046; color: #FFFFFF; padding: 12px; text-align: left; font-weight: 600; font-size: 14px; border-radius: 8px 0 0 0;">
                                            Produkt
                                        </th>
                                        <th style="background-color: #240046; color: #FFFFFF; padding: 12px; text-align: center; font-weight: 600; font-size: 14px; width: 80px;">
                                            Ilo≈õƒá
                                        </th>
                                        <th style="background-color: #240046; color: #FFFFFF; padding: 12px; text-align: right; font-weight: 600; font-size: 14px; width: 100px;">
                                            Cena
                                        </th>
                                        <th style="background-color: #240046; color: #FFFFFF; padding: 12px; text-align: center; font-weight: 600; font-size: 14px; width: 140px; border-radius: 0 8px 0 0;">
                                            Status
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for item in items %}
                                    <tr>
                                        <td style="padding: 12px; border-bottom: 1px solid #E0E0E0; font-size: 14px; color: #212121;">
                                            {{ item.product_name }}
                                        </td>
                                        <td style="padding: 12px; border-bottom: 1px solid #E0E0E0; text-align: center; font-size: 14px; color: #212121;">
                                            {{ item.quantity }}
                                        </td>
                                        <td style="padding: 12px; border-bottom: 1px solid #E0E0E0; text-align: right; font-size: 14px; color: #212121;">
                                            {{ "%.2f"|format(item.price) }} PLN
                                        </td>
                                        <td style="padding: 12px; border-bottom: 1px solid #E0E0E0; text-align: center;">
                                            {% if item.is_fulfilled %}
                                            <span style="background-color: #d4edda; color: #155724; padding: 6px 12px; border-radius: 8px; font-weight: 600; font-size: 12px; display: inline-block; white-space: nowrap;">
                                                ‚úì Do realizacji
                                            </span>
                                            {% else %}
                                            <span style="background-color: #f8d7da; color: #721c24; padding: 6px 12px; border-radius: 8px; font-weight: 600; font-size: 12px; display: inline-block; white-space: nowrap;">
                                                ‚úó Poza setem
                                            </span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>

                            {% set fulfilled_items_list = items | selectattr('is_fulfilled') | list %}
                            {% set unfulfilled_items_list = items | rejectattr('is_fulfilled') | list %}

                            <!-- Financial summary -->
                            {% if fulfilled_items_list %}
                            <table width="100%" cellpadding="0" cellspacing="0" border="0" style="margin: 30px 0 20px 0;">
                                <tr>
                                    <td style="background-color: #F5F5F5; padding: 20px; border-radius: 8px;">
                                        <h3 style="margin: 0 0 16px 0; font-size: 16px; font-weight: 600; color: #240046;">
                                            Podsumowanie finansowe
                                        </h3>

                                        <table width="100%" cellpadding="0" cellspacing="0" border="0">
                                            <tr>
                                                <td style="padding: 8px 0; font-size: 14px; color: #616161;">
                                                    Produkty ({{ fulfilled_items_list|length }} szt.)
                                                </td>
                                                <td align="right" style="padding: 8px 0; font-size: 14px; color: #212121; font-weight: 500;">
                                                    {{ "%.2f"|format(fulfilled_total) }} PLN
                                                </td>
                                            </tr>
                                            <tr>
                                                <td colspan="2" style="padding: 12px 0 8px 0;">
                                                    <hr style="border: 0; border-top: 2px solid #E0E0E0; margin: 0;" />
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style="padding: 8px 0; font-size: 18px; color: #240046; font-weight: 700;">
                                                    Do zap≈Çaty
                                                </td>
                                                <td align="right" style="padding: 8px 0; font-size: 20px; color: #7B2CBF; font-weight: 700;">
                                                    {{ "%.2f"|format(fulfilled_total) }} PLN
                                                </td>
                                            </tr>
                                        </table>

                                        <p style="margin: 16px 0 0 0; font-size: 13px; color: #757575; font-style: italic;">
                                            * Koszt wysy≈Çki nie jest uwzglƒôdniony. Zostanie dodany po dostarczeniu produkt√≥w do magazynu.
                                        </p>
                                    </td>
                                </tr>
                            </table>
                            {% endif %}

                            <!-- Payment methods -->
                            {% if payment_methods and fulfilled_items_list %}
                            <h3 style="margin: 30px 0 12px 0; font-size: 16px; font-weight: 600; color: #240046;">
                                Dostƒôpne metody p≈Çatno≈õci
                            </h3>
                            <ul style="margin: 0 0 20px 0; padding: 0 0 0 20px; font-size: 14px; color: #212121; line-height: 1.8;">
                                {% for method in payment_methods %}
                                <li style="margin: 4px 0;">{{ method.name }}</li>
                                {% endfor %}
                            </ul>
                            <p style="margin: 0 0 20px 0; font-size: 14px; color: #616161;">
                                Szczeg√≥≈Çy przelew√≥w (numer konta, dane odbiorcy) dostƒôpne sƒÖ po klikniƒôciu przycisku poni≈ºej, w oknie sk≈Çadania potwierdzenia p≈Çatno≈õci.
                            </p>
                            {% endif %}

                            <!-- CTA Button -->
                            {% if upload_payment_url and fulfilled_items_list %}
                            <table width="100%" cellpadding="0" cellspacing="0" border="0" style="margin: 30px 0;">
                                <tr>
                                    <td align="center">
                                        <a href="{{ upload_payment_url }}" style="display: inline-block; background-color: #240046; color: #FFFFFF; text-decoration: none; padding: 14px 32px; border-radius: 8px; font-weight: 600; font-size: 16px; text-align: center;">
                                            Wgraj potwierdzenie wp≈Çaty
                                        </a>
                                    </td>
                                </tr>
                            </table>
                            {% endif %}

                            <!-- Info boxes -->
                            {% if fulfilled_items_list %}
                            <table width="100%" cellpadding="0" cellspacing="0" border="0" style="margin: 30px 0 20px 0;">
                                <tr>
                                    <td style="background-color: #d4edda; border-left: 4px solid #4CAF50; padding: 16px; border-radius: 0 8px 8px 0;">
                                        <p style="margin: 0; font-size: 14px; color: #155724; font-weight: 600;">
                                            ‚úì Produkty zakwalifikowane ({{ fulfilled_items_list|length }})
                                        </p>
                                        <p style="margin: 8px 0 0 0; font-size: 14px; color: #155724;">
                                            Te produkty zostanƒÖ zam√≥wione i dostarczone do Ciebie. Otrzymasz kolejne powiadomienie, gdy zam√≥wienie zmieni status.
                                        </p>
                                    </td>
                                </tr>
                            </table>
                            {% endif %}

                            {% if unfulfilled_items_list %}
                            <table width="100%" cellpadding="0" cellspacing="0" border="0" style="margin: 20px 0;">
                                <tr>
                                    <td style="background-color: #fff3cd; border-left: 4px solid #FFC107; padding: 16px; border-radius: 0 8px 8px 0;">
                                        <p style="margin: 0; font-size: 14px; color: #856404; font-weight: 600;">
                                            Produkty poza setem ({{ unfulfilled_items_list|length }})
                                        </p>
                                        <p style="margin: 8px 0 0 0; font-size: 14px; color: #856404;">
                                            Niestety, niekt√≥re z Twoich produkt√≥w nie zosta≈Çy zakwalifikowane do setu, poniewa≈º nie zebra≈Ça siƒô wystarczajƒÖca liczba zam√≥wie≈Ñ.
                                        </p>
                                        <p style="margin: 8px 0 0 0; font-size: 14px; color: #856404;">
                                            Produkty w setach sƒÖ realizowane wed≈Çug kolejno≈õci zam√≥wie≈Ñ (kto pierwszy, ten lepszy).
                                        </p>
                                        <p style="margin: 8px 0 0 0; font-size: 14px; color: #856404; font-weight: 600;">
                                            <strong>Nie musisz nic robiƒá</strong> - p≈Çatno≈õƒá za niezrealizowane produkty nie zosta≈Ça pobrana.
                                        </p>
                                    </td>
                                </tr>
                            </table>
                            {% endif %}

                            {% if not unfulfilled_items_list and fulfilled_items_list %}
                            <table width="100%" cellpadding="0" cellspacing="0" border="0" style="margin: 20px 0;">
                                <tr>
                                    <td style="background-color: #e3f2fd; border-left: 4px solid #2196F3; padding: 16px; border-radius: 0 8px 8px 0;">
                                        <p style="margin: 0; font-size: 14px; color: #0d47a1; font-weight: 600;">
                                            üéâ Wszystkie Twoje produkty zosta≈Çy zakwalifikowane do setu!
                                        </p>
                                        <p style="margin: 8px 0 0 0; font-size: 14px; color: #0d47a1;">
                                            Gratulacje! Mo≈ºesz teraz dokonaƒá p≈Çatno≈õci i poczekaƒá na kolejne powiadomienie o zmianie statusu zam√≥wienia.
                                        </p>
                                    </td>
                                </tr>
                            </table>
                            {% endif %}

                            <!-- Link to order details -->
                            {% if upload_payment_url %}
                            <p style="margin: 30px 0 10px 0; font-size: 14px; color: #616161;">
                                Status zam√≥wienia i szczeg√≥≈Çy mo≈ºesz sprawdziƒá pod tym linkiem:
                            </p>
                            <p style="margin: 0 0 20px 0;">
                                <a href="{{ upload_payment_url.replace('?action=upload_payment', '') }}" style="color: #7B2CBF; text-decoration: underline; font-size: 14px;">
                                    PodglƒÖd zam√≥wienia {{ order_number }}
                                </a>
                            </p>
                            {% else %}
                            <p style="margin: 30px 0 10px 0; font-size: 14px; color: #616161;">
                                Status zam√≥wienia mo≈ºesz sprawdziƒá w panelu klienta:
                            </p>
                            <p style="margin: 0 0 20px 0;">
                                <a href="{{ url_for('orders.client_list', _external=True) }}" style="color: #7B2CBF; text-decoration: underline; font-size: 14px;">
                                    Panel zam√≥wie≈Ñ
                                </a>
                            </p>
                            {% endif %}

                        </td>
                    </tr>

                    <!-- Footer -->
                    <tr>
                        <td style="padding: 30px 40px; background-color: #F5F5F5; border-top: 1px solid #E0E0E0; text-align: center;">
                            <img src="cid:logo@thunderorders" alt="ThunderOrders" style="height: 32px; width: auto; display: block; margin: 0 auto 12px auto;" />
                            <p style="margin: 0; font-size: 12px; color: #9E9E9E;">
                                <a href="https://thunderorders.cloud" style="color: #7B2CBF; text-decoration: none;">thunderorders.cloud</a> |
                                <a href="mailto:noreply@thunderorders.cloud" style="color: #7B2CBF; text-decoration: none;">noreply@thunderorders.cloud</a>
                            </p>
                        </td>
                    </tr>

                </table>
            </td>
        </tr>
    </table>
</body>
</html>
